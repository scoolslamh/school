<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØµÙØ­Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom right, #e8f5e9, #ffffff);
      padding: 20px;
      color: #2e7d32;
    }
    .main-header {
      background-color: #1b5e20;
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 25px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .main-header h1 { margin: 0; font-size: 24px; }
    .main-header h2 { margin: 5px 0 0; font-size: 18px; font-weight: normal; color: #c8e6c9; }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
      align-items: center;
    }
    .top-bar button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      background-color: #388e3c;
      color: white;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .top-bar button:hover { background-color: #2e7d32; }
    #userInfo {
      background-color: #f1f8e9;
      color: #2e7d32;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .search-container {
      max-width: 800px;
      margin: auto;
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    input, select {
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #bdbdbd;
      margin: 6px;
      font-size: 15px;
      max-width: 320px;
      width: 100%;
    }
    .table-container { overflow-x: auto; margin-top: 20px; }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 1000px;
      background-color: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    th {
      background-color: #2e7d32;
      color: white;
      padding: 10px;
    }
    td {
      padding: 10px;
      border: 1px solid #e0e0e0;
    }
    tr:nth-child(even) { background-color: #f1f8e9; }
    #totalCount {
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
      color: #1b5e20;
    }
  </style>
</head>
<body>
  <div class="main-header">
    <h1>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ±</h1>
    <h2>Ù‚Ø³Ù… Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚</h2>
  </div>
  <div class="top-bar" style="justify-content: space-between; background-color: #f1f8e9; border-radius: 12px; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
  <div id="userInfo" style="display: flex; align-items: center; gap: 10px; font-weight: bold; font-size: 15px; color: #2e7d32;">
    <i class="fas fa-user-circle"></i>
    <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <strong id="userNameLabel">...</strong> | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: <strong id="userRoleLabel">...</strong></span>
  </div>
  <div>
    <button onclick="window.open('https://ali71425.github.io/school-data-page/', '_blank')"><i class="fas fa-chart-line"></i> Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
    <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>
  <div class="search-container">
    <select id="sectorFilter"><option value="">ğŸ“ Ø§Ù„ÙƒÙ„ - Ø§Ù„Ù‚Ø·Ø§Ø¹</option></select>
    <select id="typeFilter"><option value="">ğŸ« Ø§Ù„ÙƒÙ„ - Ø§Ù„Ù†ÙˆØ¹</option></select>
    <input id="searchInput" type="text" placeholder="ğŸ” Ø£Ø¯Ø®Ù„ 3 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±"/>
    <div id="tooShort" style="display:none; color:#c62828; font-weight:bold;">âš ï¸ Ø£Ø¯Ø®Ù„ 3 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</div>
    <div id="loadingMessage" style="display:none; color:#f9a825;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>
    <div id="schoolCount" style="display:none;">Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: <span id="countValue"></span></div>
  </div>
  <div class="table-container">
    <table id="resultsTable" style="display:none;">
      <thead>
        <tr>
          <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</th><th>Ø§Ù„Ù‚Ø·Ø§Ø¹</th><th>Ø§Ù„Ù…ÙƒØªØ¨</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±/Ø©</th><th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø³Ù‚/Ø©</th><th>Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ù†Ø³Ù‚/Ø©</th>
          <th>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ£ÙƒÙŠØ¯</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="noResults" style="display:none; color:#c62828; text-align:center; font-weight:bold;">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</div>
  </div>
  <script>
    // Ø³ÙƒØ±Ø¨Øª Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¨Ø­Ø« ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¯Ø±Ø¬ Ù…Ø³Ø¨Ù‚Ù‹Ø§
    let schoolData = [];

    function fetchSchoolData() {
      document.getElementById("loadingMessage").style.display = 'block';
      fetch('https://script.google.com/macros/s/AKfycbwmLZXbtQQuIui6c-zQTjQDsT4OPFM_YWWR3taupQ5A2hUg0TWXyZRBsxvsc56uMrDc/exec')
        .then(response => response.json())
        .then(data => {
          schoolData = data.schools || [];
          populateFilters(schoolData);
          displayResults(schoolData);
          document.getElementById("loadingMessage").style.display = 'none';
        })
        .catch(() => {
          document.getElementById("loadingMessage").textContent = "âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
        });
    }

    function populateFilters(data) {
      const sectors = new Set();
      const types = new Set();
      data.forEach(row => {
        if (row.Ø§Ù„Ù‚Ø·Ø§Ø¹) sectors.add(row.Ø§Ù„Ù‚Ø·Ø§Ø¹);
        if (row.Ø§Ù„Ù†ÙˆØ¹) types.add(row.Ø§Ù„Ù†ÙˆØ¹);
      });
      const sectorSelect = document.getElementById("sectorFilter");
      const typeSelect = document.getElementById("typeFilter");
      sectors.forEach(sec => {
        const option = document.createElement("option");
        option.value = sec;
        option.textContent = sec;
        sectorSelect.appendChild(option);
      });
      types.forEach(type => {
        const option = document.createElement("option");
        option.value = type;
        option.textContent = type;
        typeSelect.appendChild(option);
      });
    }

    function displayResults(data) {
      const tbody = document.querySelector("#resultsTable tbody");
      tbody.innerHTML = "";
      if (data.length === 0) {
        document.getElementById("resultsTable").style.display = "none";
        document.getElementById("noResults").style.display = "block";
        document.getElementById("schoolCount").style.display = "none";
        return;
      }
      data.forEach(row => {
        const tr = document.createElement("tr");
        [
          'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ', 'Ø§Ù„Ù‚Ø·Ø§Ø¹', 'Ø§Ù„Ù…ÙƒØªØ¨', 'Ø§Ù„Ù†ÙˆØ¹', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©',
          'Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±/Ø©', 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„', 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø³Ù‚/Ø©', 'Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ù†Ø³Ù‚/Ø©',
          'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯', 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ£ÙƒÙŠØ¯'
        ].forEach(key => {
          const td = document.createElement("td");
          td.textContent = row[key] || '';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      document.getElementById("resultsTable").style.display = "table";
      document.getElementById("noResults").style.display = "none";
      document.getElementById("schoolCount").style.display = "block";
      document.getElementById("countValue").textContent = data.length;
    }

    function filterResults() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const sector = document.getElementById("sectorFilter").value;
      const type = document.getElementById("typeFilter").value;
      if (query.length > 0 && query.length < 3) {
        document.getElementById("tooShort").style.display = 'block';
        document.getElementById("resultsTable").style.display = "none";
        document.getElementById("schoolCount").style.display = "none";
        document.getElementById("noResults").style.display = "none";
        return;
      } else {
        document.getElementById("tooShort").style.display = 'none';
      }
      let filtered = schoolData.filter(row => {
        const matchQuery = query.length < 3 || Object.values(row).some(v => v && String(v).toLowerCase().includes(query));
        const matchSector = !sector || row["Ø§Ù„Ù‚Ø·Ø§Ø¹"] === sector;
        const matchType = !type || row["Ø§Ù„Ù†ÙˆØ¹"] === type;
        return matchQuery && matchSector && matchType;
      });
      displayResults(filtered);
    }

    window.addEventListener('DOMContentLoaded', () => {
  const userName = sessionStorage.getItem("userName") || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  const userRole = sessionStorage.getItem("userRole") || "Ù…Ø³ØªØ®Ø¯Ù…";
  document.getElementById("userNameLabel").textContent = userName;
  document.getElementById("userRoleLabel").textContent = userRole;
  document.getElementById("searchInput").addEventListener("keydown", (e) => {
    if (e.key === "Enter") filterResults();
  });
  document.getElementById("searchInput").addEventListener("keydown", (e) => {
    if (e.key === "Enter") filterResults();
  });
      if (sessionStorage.getItem("authenticated") === "true") {
        fetchSchoolData();
        document.getElementById("searchInput").addEventListener("input", filterResults);
        document.getElementById("sectorFilter").addEventListener("change", filterResults);
        document.getElementById("typeFilter").addEventListener("change", filterResults);
      } else {
        const loginOverlay = document.createElement("div");
        loginOverlay.id = "loginOverlay";
        loginOverlay.style = `position: fixed; top: 0; right: 0; bottom: 0; left: 0; background-color: rgba(248, 249, 250, 0.98); z-index: 9999; display: flex; align-items: center; justify-content: center;`;
        loginOverlay.innerHTML = `
          <div style=\"background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); text-align: center; max-width: 400px; width: 100%;\">
            <h2 style=\"color: #006c35; margin-bottom: 20px;\">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input id=\"userCodeInput\" type=\"text\" placeholder=\"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\" style=\"padding: 12px; font-size: 16px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px;\"/>
            <button onclick=\"verifyUserCode()\" style=\"background-color: #006c35; color: white; padding: 12px 20px; font-size: 16px; border: none; border-radius: 6px; cursor: pointer;\">Ø¯Ø®ÙˆÙ„</button>
            <p id=\"loginError\" style=\"color: red; margin-top: 10px; display: none;\">âŒ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡</p>
          </div>
        `;
        document.body.appendChild(loginOverlay);
      }
    });

    function verifyUserCode() {
      const userCode = document.getElementById("userCodeInput").value.trim();
      fetch(`https://script.google.com/macros/s/AKfycbwmLZXbtQQuIui6c-zQTjQDsT4OPFM_YWWR3taupQ5A2hUg0TWXyZRBsxvsc56uMrDc/exec?code=${userCode}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            sessionStorage.setItem("authenticated", "true");
            sessionStorage.setItem("userName", data.name);
            sessionStorage.setItem("userRole", data.role);
            sessionStorage.setItem("userSchool", data.schoolCode);
            sessionStorage.setItem("loginTime", Date.now());
            location.reload();
          } else {
            document.getElementById("loginError").style.display = 'block';
          }
        });
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = window.location.href;
    }
  </script>
</body>
</html>
